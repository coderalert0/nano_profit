<tr id="<%= dom_id(alert) %>" class="table-row">
  <td class="py-3 px-4 text-xs text-slate-500 whitespace-nowrap" data-sort-value="<%= alert.created_at.to_i %>"><%= format_time(alert.created_at, millis: false) %></td>
  <td class="py-3 px-4 whitespace-nowrap">
    <% if alert.alert_type == "negative_margin" %>
      <span class="badge badge-red"><%= t("alerts.alert_row.negative_margin") %></span>
    <% else %>
      <span class="badge badge-yellow"><%= t("alerts.alert_row.below_threshold") %></span>
    <% end %>
  </td>
  <td class="py-3 px-4">
    <% if alert.event_type? %>
      <span class="badge badge-blue text-xs"><%= t("alerts.alert_row.event_type") %></span>
      <div class="truncate max-w-[10rem]"><%= link_to alert.dimension_value, events_path(event_type: alert.dimension_value), class: "link" %></div>
    <% elsif alert.customer? %>
      <span class="badge badge-gray text-xs"><%= t("alerts.alert_row.customer") %></span>
      <% customer = alert.organization.customers.find_by(id: alert.dimension_value) %>
      <% if customer %>
        <div class="truncate max-w-[10rem]"><%= link_to customer.name || customer.external_id, customer_path(customer), class: "link" %></div>
      <% else %>
        <div class="truncate max-w-[10rem] text-slate-400"><%= alert.dimension_value %></div>
      <% end %>
    <% end %>
  </td>
  <td class="py-3 px-4 text-slate-700">
    <%= alert.message %>
  </td>
  <td class="py-3 px-4 whitespace-nowrap">
    <% if alert.acknowledged? %>
      <span class="inline-flex items-center gap-1.5 text-xs text-emerald-600">
        <span class="w-1.5 h-1.5 rounded-full bg-emerald-500"></span>
        <%= t("alerts.alert_row.acknowledged") %>
      </span>
      <% if alert.acknowledged_by %>
        <span class="block text-xs text-slate-400"><%= alert.acknowledged_by.email_address %></span>
      <% end %>
      <% if alert.notes.present? %>
        <span class="block text-xs text-slate-500 italic whitespace-normal"><%= alert.notes %></span>
      <% end %>
      <span class="block text-xs text-slate-400"><%= format_time(alert.acknowledged_at, millis: false) %></span>
    <% else %>
      <span class="inline-flex items-center gap-1.5 text-xs font-medium text-red-600">
        <span class="w-1.5 h-1.5 rounded-full bg-red-500 animate-pulse"></span>
        <%= t("alerts.alert_row.active") %>
      </span>
    <% end %>
  </td>
  <td class="py-3 px-4">
    <% unless alert.acknowledged? %>
      <div data-controller="dialog">
        <button type="button" data-action="dialog#open" class="btn-secondary text-xs px-3 py-1">
          <%= t("alerts.alert_row.acknowledge") %>
        </button>

        <dialog data-dialog-target="modal" class="fixed top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 m-0 rounded-xl shadow-xl p-0 backdrop:bg-black/50 max-w-md w-full border border-slate-200" data-action="click->dialog#clickOutside">
          <div class="p-6">
            <h3 class="text-lg font-semibold text-slate-900 mb-2"><%= t("alerts.alert_row.acknowledge_title") %></h3>
            <p class="text-sm text-slate-600 mb-4"><%= alert.message %></p>

            <%= form_with url: acknowledge_admin_margin_alert_path(alert), method: :patch, class: "space-y-4" do |f| %>
              <div>
                <label for="notes_<%= dom_id(alert) %>" class="block text-sm font-medium text-slate-700 mb-1"><%= t("alerts.alert_row.resolution_notes") %></label>
                <textarea name="notes" id="notes_<%= dom_id(alert) %>" rows="3" class="input-field" placeholder="<%= t("alerts.alert_row.resolution_placeholder") %>"></textarea>
              </div>
              <div class="flex justify-end gap-2">
                <button type="button" data-action="dialog#close" class="btn-secondary"><%= t("alerts.alert_row.cancel") %></button>
                <button type="submit" class="btn-primary"><%= t("alerts.alert_row.confirm") %></button>
              </div>
            <% end %>
          </div>
        </dialog>
      </div>
    <% end %>
  </td>
</tr>
