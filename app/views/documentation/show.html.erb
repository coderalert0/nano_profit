<h1 class="text-2xl font-bold text-slate-900 mb-6"><%= t("documentation.show.title") %></h1>

<div class="space-y-6">
  <!-- SDK Installation -->
  <div class="card p-6">
    <h2 class="text-lg font-semibold text-slate-900 mb-1"><%= t("documentation.show.sdk_setup") %></h2>
    <p class="text-sm text-slate-500 mb-4"><%= t("documentation.show.sdk_setup_description") %></p>

    <div class="space-y-4">
      <div class="rounded-lg overflow-hidden border border-slate-700">
        <div class="bg-slate-800 px-4 py-2 text-xs font-mono text-slate-400">npm</div>
        <pre class="bg-slate-900 text-emerald-400 p-4 text-xs overflow-x-auto"><code>npm install nanoprofit</code></pre>
      </div>

      <div class="rounded-lg overflow-hidden border border-slate-700">
        <div class="bg-slate-800 px-4 py-2 text-xs font-mono text-slate-400">pip</div>
        <pre class="bg-slate-900 text-emerald-400 p-4 text-xs overflow-x-auto"><code>pip install nanoprofit</code></pre>
      </div>
    </div>
  </div>

  <!-- TypeScript Usage -->
  <div class="card p-6">
    <h2 class="text-lg font-semibold text-slate-900 mb-1"><%= t("documentation.show.typescript_usage") %></h2>
    <p class="text-sm text-slate-500 mb-4"><%= t("documentation.show.typescript_usage_description") %></p>

    <div class="rounded-lg overflow-hidden border border-slate-700">
      <div class="bg-slate-800 px-4 py-2 text-xs font-mono text-slate-400">TypeScript</div>
      <pre class="bg-slate-900 text-emerald-400 p-4 text-xs overflow-x-auto"><code>import { NanoProfit } from "nanoprofit";
import OpenAI from "openai";

const np = new NanoProfit({
  apiKey: "<%= @organization.api_key %>",
  baseUrl: "<%= request.base_url %>/api/v1",
});
const openai = new OpenAI();

const response = await openai.chat.completions.create({
  model: "gpt-4o",
  messages: [{ role: "user", content: "Hello!" }],
});

np.addResponse("openai", response);
np.track({
  customerExternalId: "cust_123",
  revenueAmountInCents: 500,
});

// Events are flushed automatically in the background.
// Before your process exits:
await np.shutdown();</code></pre>
    </div>
  </div>

  <!-- Python Usage -->
  <div class="card p-6">
    <h2 class="text-lg font-semibold text-slate-900 mb-1"><%= t("documentation.show.python_usage") %></h2>
    <p class="text-sm text-slate-500 mb-4"><%= t("documentation.show.python_usage_description") %></p>

    <div class="rounded-lg overflow-hidden border border-slate-700">
      <div class="bg-slate-800 px-4 py-2 text-xs font-mono text-slate-400">Python</div>
      <pre class="bg-slate-900 text-emerald-400 p-4 text-xs overflow-x-auto"><code>import asyncio
from openai import AsyncOpenAI
from nanoprofit import NanoProfit, Event

async def main():
    openai = AsyncOpenAI()

    async with NanoProfit(
        api_key="<%= @organization.api_key %>",
        base_url="<%= request.base_url %>/api/v1",
    ) as np:
        response = await openai.chat.completions.create(
            model="gpt-4o",
            messages=[{"role": "user", "content": "Hello!"}],
        )

        np.add_response("openai", response)
        np.track(Event(
            customer_external_id="cust_123",
            revenue_amount_in_cents=500,
        ))

    # Events are automatically flushed when exiting the context manager.

asyncio.run(main())</code></pre>
    </div>
  </div>

  <!-- Vendor Costs Note -->
  <div class="card p-6">
    <h2 class="text-lg font-semibold text-slate-900 mb-1"><%= t("documentation.show.vendor_costs") %></h2>
    <div class="flex items-start gap-2 bg-blue-50 border border-blue-200 rounded-lg p-4">
      <svg class="w-4 h-4 text-blue-500 mt-0.5 shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"/></svg>
      <p class="text-sm text-blue-700"><strong>Note:</strong> Just pass the vendor name and the raw AI provider response via <code class="bg-blue-100 px-1.5 py-0.5 rounded text-xs font-mono">addResponse()</code>. The server automatically extracts the model name and token counts, then calculates cost from your configured vendor rates. For agent sessions with multiple AI calls, call <code class="bg-blue-100 px-1.5 py-0.5 rounded text-xs font-mono">addResponse()</code> once per call, then <code class="bg-blue-100 px-1.5 py-0.5 rounded text-xs font-mono">track()</code> once to attach them all.</p>
    </div>
  </div>

  <!-- Linking Stripe to Usage Tracking -->
  <div class="card p-6">
    <h2 class="text-lg font-semibold text-slate-900 mb-1">Linking Stripe to Usage Tracking</h2>
    <p class="text-sm text-slate-600 mb-4">
      By passing your <code class="bg-slate-100 px-1.5 py-0.5 rounded text-xs font-mono">customer_external_id</code> into Stripe's
      <code class="bg-slate-100 px-1.5 py-0.5 rounded text-xs font-mono">client_reference_id</code> or
      <code class="bg-slate-100 px-1.5 py-0.5 rounded text-xs font-mono">metadata</code>, our SubscriptionSyncService can automatically
      match Stripe payments to the correct customer in your dashboard. This ensures that subscription revenue
      is attributed to the same customer as your events, enabling accurate margin calculations.
    </p>

    <h3 class="text-sm font-semibold text-slate-800 mb-2">Stripe Checkout Session</h3>
    <p class="text-sm text-slate-500 mb-2">Pass the ID as <code class="bg-slate-100 px-1.5 py-0.5 rounded text-xs font-mono">client_reference_id</code> when creating a Checkout Session:</p>
    <div class="rounded-lg overflow-hidden border border-slate-700 mb-6">
      <div class="bg-slate-800 px-4 py-2 text-xs font-mono text-slate-400">cURL</div>
      <pre class="bg-slate-900 text-emerald-400 p-4 text-xs overflow-x-auto"><code>curl https://api.stripe.com/v1/checkout/sessions \
  -u "sk_live_YOUR_KEY:" \
  -d "mode=subscription" \
  -d "line_items[0][price]=price_ABC123" \
  -d "line_items[0][quantity]=1" \
  --data-urlencode "client_reference_id=CUST_12345" \
  -d "success_url=https://example.com/success" \
  -d "cancel_url=https://example.com/cancel"</code></pre>
    </div>

    <h3 class="text-sm font-semibold text-slate-800 mb-2">Stripe Customer Creation</h3>
    <p class="text-sm text-slate-500 mb-2">Alternatively, store the ID in the customer's metadata when creating a Stripe Customer:</p>
    <div class="rounded-lg overflow-hidden border border-slate-700 mb-6">
      <div class="bg-slate-800 px-4 py-2 text-xs font-mono text-slate-400">cURL</div>
      <pre class="bg-slate-900 text-emerald-400 p-4 text-xs overflow-x-auto"><code>curl https://api.stripe.com/v1/customers \
  -u "sk_live_YOUR_KEY:" \
  -d "name=Acme Corp" \
  -d "email=billing@acme.com" \
  -d "metadata[external_id]=CUST_12345"</code></pre>
    </div>

    <div class="bg-amber-50 border border-amber-200 rounded-lg p-4">
      <div class="flex items-start gap-2">
        <svg class="w-4 h-4 text-amber-500 mt-0.5 shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"/></svg>
        <div>
          <p class="text-sm font-semibold text-amber-800">Developer Note</p>
          <p class="text-sm text-amber-700 mt-1">
            The ID you pass to Stripe (<code class="bg-amber-100 px-1.5 py-0.5 rounded text-xs font-mono">CUST_12345</code>) must exactly match the
            <code class="bg-amber-100 px-1.5 py-0.5 rounded text-xs font-mono">customer_external_id</code> you send in your events.
            If these values don't match, NanoProfit cannot link subscription revenue to usage costs, and margin calculations will be inaccurate.
          </p>
        </div>
      </div>
    </div>
  </div>
</div>
