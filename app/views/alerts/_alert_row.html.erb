<tr id="<%= dom_id(alert) %>" class="table-row">
  <td class="py-3 px-4 text-gray-500" data-sort-value="<%= alert.created_at.to_i %>"><%= format_time(alert.created_at) %></td>
  <td class="py-3 px-4">
    <% if alert.alert_type == "negative_margin" %>
      <span class="badge badge-red">Negative Margin</span>
    <% else %>
      <span class="badge badge-yellow">Below Threshold</span>
    <% end %>
  </td>
  <td class="py-3 px-4">
    <% if alert.customer %>
      <%= link_to alert.customer.name || alert.customer.external_id, customer_path(alert.customer), class: "link" %>
    <% else %>
      <span class="text-gray-400">-</span>
    <% end %>
  </td>
  <td class="py-3 px-4">
    <%= alert.message %>
    <% if alert.notes.present? %>
      <p class="text-xs text-gray-500 italic mt-1"><%= alert.notes %></p>
    <% end %>
  </td>
  <td class="py-3 px-4">
    <% if alert.acknowledged? %>
      <span class="text-green-600 text-xs">Acknowledged</span>
      <% if alert.acknowledged_by %>
        <span class="block text-xs text-gray-400"><%= alert.acknowledged_by.email_address %></span>
      <% end %>
      <span class="block text-xs text-gray-400"><%= format_time(alert.acknowledged_at) %></span>
    <% else %>
      <span class="text-red-600 text-xs font-medium">Active</span>
    <% end %>
  </td>
  <td class="py-3 px-4">
    <% unless alert.acknowledged? %>
      <div data-controller="dialog">
        <button type="button" data-action="dialog#open" class="text-xs bg-gray-100 hover:bg-gray-200 text-gray-700 px-3 py-1 rounded cursor-pointer">
          Acknowledge
        </button>

        <dialog data-dialog-target="modal" class="rounded-lg shadow-xl p-0 backdrop:bg-black/50 max-w-md w-full" data-action="click->dialog#clickOutside">
          <div class="p-6">
            <h3 class="text-lg font-semibold text-gray-900 mb-2">Acknowledge Alert</h3>
            <p class="text-sm text-gray-600 mb-4"><%= alert.message %></p>

            <%= form_with url: acknowledge_admin_margin_alert_path(alert), method: :patch, class: "space-y-4" do |f| %>
              <div>
                <label for="notes_<%= dom_id(alert) %>" class="block text-sm font-medium text-gray-700 mb-1">Resolution Notes</label>
                <textarea name="notes" id="notes_<%= dom_id(alert) %>" rows="3" class="w-full border border-gray-300 rounded-md px-3 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-blue-500" placeholder="Optional: describe what was done to resolve this alert..."></textarea>
              </div>
              <div class="flex justify-end gap-2">
                <button type="button" data-action="dialog#close" class="px-4 py-2 text-sm text-gray-700 bg-gray-100 hover:bg-gray-200 rounded-md cursor-pointer">Cancel</button>
                <button type="submit" class="px-4 py-2 text-sm text-white bg-blue-600 hover:bg-blue-700 rounded-md cursor-pointer">Confirm</button>
              </div>
            <% end %>
          </div>
        </dialog>
      </div>
    <% end %>
  </td>
</tr>
