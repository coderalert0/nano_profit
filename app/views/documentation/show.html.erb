<h1 class="text-2xl font-bold text-slate-900 mb-6"><%= t("documentation.show.title") %></h1>

<div class="space-y-6">
  <!-- API Usage Example -->
  <div class="card p-6">
    <h2 class="text-lg font-semibold text-slate-900 mb-1"><%= t("documentation.show.api_usage") %></h2>
    <p class="text-sm text-slate-500 mb-4"><%= t("documentation.show.api_usage_description").html_safe %></p>

    <div class="rounded-lg overflow-hidden border border-slate-700">
      <div class="bg-slate-800 px-4 py-2 text-xs font-mono text-slate-400">cURL</div>
      <pre class="bg-slate-900 text-emerald-400 p-4 text-xs overflow-x-auto"><code>curl -X POST <%= request.base_url %>/api/v1/events \
  -H "Content-Type: application/json" \
  -H "Authorization: Bearer <%= @organization.api_key %>" \
  -d '{
  "event": {
    "unique_request_token": "req_abc123",
    "customer_external_id": "cust_123",
    "customer_name": "Acme Corp",
    "event_type": "ai_analysis",
    "revenue_amount_in_cents": 1000,
    "vendor_costs": [
      { "vendor_name": "openai", "ai_model_name": "gpt-4o", "input_tokens": 12000, "output_tokens": 3000, "unit_count": 15000, "unit_type": "tokens" }
    ],
    "metadata": {},
    "occurred_at": "<%= Time.current.iso8601 %>"
  }
}'</code></pre>
    </div>
    <div class="mt-4 flex items-start gap-2 bg-blue-50 border border-blue-200 rounded-lg p-4">
      <svg class="w-4 h-4 text-blue-500 mt-0.5 shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"/></svg>
      <p class="text-sm text-blue-700"><strong>Note:</strong> <code class="bg-blue-100 px-1.5 py-0.5 rounded text-xs font-mono">amount_in_cents</code> is optional when <code class="bg-blue-100 px-1.5 py-0.5 rounded text-xs font-mono">ai_model_name</code> and token counts (<code class="bg-blue-100 px-1.5 py-0.5 rounded text-xs font-mono">input_tokens</code>, <code class="bg-blue-100 px-1.5 py-0.5 rounded text-xs font-mono">output_tokens</code>) are provided. Cost is calculated automatically from configured vendor rates.</p>
    </div>
  </div>

  <!-- Linking Stripe to Usage Tracking -->
  <div class="card p-6">
    <h2 class="text-lg font-semibold text-slate-900 mb-1">Linking Stripe to Usage Tracking</h2>
    <p class="text-sm text-slate-600 mb-4">
      By passing your <code class="bg-slate-100 px-1.5 py-0.5 rounded text-xs font-mono">customer_external_id</code> into Stripe's
      <code class="bg-slate-100 px-1.5 py-0.5 rounded text-xs font-mono">client_reference_id</code> or
      <code class="bg-slate-100 px-1.5 py-0.5 rounded text-xs font-mono">metadata</code>, our SubscriptionSyncService can automatically
      match Stripe payments to the correct customer in your dashboard. This ensures that subscription revenue
      is attributed to the same customer as your events, enabling accurate margin calculations.
    </p>

    <h3 class="text-sm font-semibold text-slate-800 mb-2">Stripe Checkout Session</h3>
    <p class="text-sm text-slate-500 mb-2">Pass the ID as <code class="bg-slate-100 px-1.5 py-0.5 rounded text-xs font-mono">client_reference_id</code> when creating a Checkout Session:</p>
    <div class="rounded-lg overflow-hidden border border-slate-700 mb-6">
      <div class="bg-slate-800 px-4 py-2 text-xs font-mono text-slate-400">cURL</div>
      <pre class="bg-slate-900 text-emerald-400 p-4 text-xs overflow-x-auto"><code>curl https://api.stripe.com/v1/checkout/sessions \
  -u "sk_live_YOUR_KEY:" \
  -d "mode=subscription" \
  -d "line_items[0][price]=price_ABC123" \
  -d "line_items[0][quantity]=1" \
  --data-urlencode "client_reference_id=CUST_12345" \
  -d "success_url=https://example.com/success" \
  -d "cancel_url=https://example.com/cancel"</code></pre>
    </div>

    <h3 class="text-sm font-semibold text-slate-800 mb-2">Stripe Customer Creation</h3>
    <p class="text-sm text-slate-500 mb-2">Alternatively, store the ID in the customer's metadata when creating a Stripe Customer:</p>
    <div class="rounded-lg overflow-hidden border border-slate-700 mb-6">
      <div class="bg-slate-800 px-4 py-2 text-xs font-mono text-slate-400">cURL</div>
      <pre class="bg-slate-900 text-emerald-400 p-4 text-xs overflow-x-auto"><code>curl https://api.stripe.com/v1/customers \
  -u "sk_live_YOUR_KEY:" \
  -d "name=Acme Corp" \
  -d "email=billing@acme.com" \
  -d "metadata[external_id]=CUST_12345"</code></pre>
    </div>

    <div class="bg-amber-50 border border-amber-200 rounded-lg p-4">
      <div class="flex items-start gap-2">
        <svg class="w-4 h-4 text-amber-500 mt-0.5 shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"/></svg>
        <div>
          <p class="text-sm font-semibold text-amber-800">Developer Note</p>
          <p class="text-sm text-amber-700 mt-1">
            The ID you pass to Stripe (<code class="bg-amber-100 px-1.5 py-0.5 rounded text-xs font-mono">CUST_12345</code>) must exactly match the
            <code class="bg-amber-100 px-1.5 py-0.5 rounded text-xs font-mono">customer_external_id</code> you send in your events.
            If these values don't match, NanoProfit cannot link subscription revenue to usage costs, and margin calculations will be inaccurate.
          </p>
        </div>
      </div>
    </div>
  </div>
</div>
