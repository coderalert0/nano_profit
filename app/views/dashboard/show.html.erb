<div data-controller="dashboard" data-dashboard-organization-id-value="<%= @organization.id %>">
  <div class="flex justify-between items-center mb-6">
    <h1 class="text-2xl font-bold text-slate-900"><%= t("dashboard.show.title") %></h1>
    <%= render "shared/period_selector", selected: @selected_period %>
  </div>

  <!-- Summary Cards -->
  <div class="grid grid-cols-1 md:grid-cols-4 gap-4 mb-8">
    <div class="stat-card stat-card-green">
      <div class="flex items-center gap-2 mb-1">
        <svg class="w-4 h-4 text-slate-400" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v8m0 0v1m0-1c-1.11 0-2.08-.402-2.599-1M21 12a9 9 0 11-18 0 9 9 0 0118 0z"/></svg>
        <p class="text-sm text-slate-500"><%= t("dashboard.show.total_revenue") %></p>
      </div>
      <p class="text-2xl font-bold text-slate-900" id="total-revenue"><%= format_cents(@margin.revenue_in_cents) %></p>
      <% if @margin.subscription_revenue_in_cents > 0 %>
        <p class="text-xs text-slate-400 mt-1"><%= t("dashboard.show.subscription_label", subscription: format_cents(@margin.subscription_revenue_in_cents), event: format_cents(@margin.event_revenue_in_cents)) %></p>
      <% end %>
    </div>
    <div class="stat-card stat-card-red">
      <div class="flex items-center gap-2 mb-1">
        <svg class="w-4 h-4 text-slate-400" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 17h8m0 0V9m0 8l-8-8-4 4-6-6"/></svg>
        <p class="text-sm text-slate-500"><%= t("dashboard.show.total_cost") %></p>
      </div>
      <p class="text-2xl font-bold text-slate-900" id="total-cost"><%= format_cents(@margin.cost_in_cents) %></p>
    </div>
    <div class="stat-card stat-card-blue">
      <div class="flex items-center gap-2 mb-1">
        <svg class="w-4 h-4 text-slate-400" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"/></svg>
        <p class="text-sm text-slate-500"><%= t("shared.margin") %></p>
      </div>
      <p class="text-2xl font-bold <%= margin_color_class(@margin.margin_in_cents) %>" id="total-margin"><%= format_cents(@margin.margin_in_cents) %></p>
    </div>
    <div class="stat-card stat-card-amber">
      <div class="flex items-center gap-2 mb-1">
        <svg class="w-4 h-4 text-slate-400" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 12l3-3 3 3 4-4M8 21l4-4 4 4M3 4h18M4 4h16v12a1 1 0 01-1 1H5a1 1 0 01-1-1V4z"/></svg>
        <p class="text-sm text-slate-500"><%= t("shared.margin_percent") %></p>
      </div>
      <p class="text-2xl font-bold <%= margin_color_class(@margin.margin_in_cents) %>" id="margin-pct"><%= format_bps(@margin.margin_bps) %></p>
    </div>
  </div>

  <!-- Revenue vs Cost Chart -->
  <div class="card p-6 mb-8">
    <h2 class="text-lg font-semibold text-slate-900 mb-4"><%= t("dashboard.show.revenue_vs_cost_over_time") %></h2>
    <%= line_chart [
      { name: t("shared.revenue"), data: @revenue_over_time },
      { name: t("shared.cost"), data: @cost_over_time }
    ], prefix: "$", library: { scales: { y: { beginAtZero: true } } } %>
  </div>

  <!-- Cost by AI Model -->
  <% if @model_costs.any? %>
    <div class="card p-6 mb-8">
      <h2 class="text-lg font-semibold text-slate-900 mb-4"><%= t("dashboard.show.cost_by_model") %></h2>
      <%= bar_chart @model_costs.transform_values { |v| v / 100.0 }, prefix: "$", colors: ["#6366f1", "#f59e0b", "#10b981", "#ef4444", "#3b82f6", "#8b5cf6", "#ec4899", "#14b8a6", "#f97316", "#84cc16"], library: { plugins: { legend: { display: false } } } %>
    </div>
  <% end %>

  <!-- Margin by Dimension Charts -->
  <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
    <div class="card p-6" data-controller="clickable-chart" data-clickable-chart-urls-value="<%= @event_type_urls.to_json %>">
      <div class="flex justify-between items-center mb-4">
        <h2 class="text-lg font-semibold text-slate-900"><%= t("dashboard.show.margin_by_event_type") %></h2>
        <%= link_to t("dashboard.show.view_all"), event_types_path, class: "text-sm link" %>
      </div>
      <% if @event_type_margins.any? %>
        <%= bar_chart @event_type_margins, suffix: "%" %>
      <% else %>
        <div class="empty-state"><p><%= t("shared.no_data") %></p></div>
      <% end %>
    </div>
    <div class="card p-6" data-controller="clickable-chart" data-clickable-chart-urls-value="<%= @customer_urls.to_json %>">
      <div class="flex justify-between items-center mb-4">
        <h2 class="text-lg font-semibold text-slate-900"><%= t("dashboard.show.margin_by_customer") %></h2>
        <%= link_to t("dashboard.show.view_all"), customers_path, class: "text-sm link" %>
      </div>
      <% if @customer_margins.any? %>
        <%= bar_chart @customer_margins, suffix: "%" %>
      <% else %>
        <div class="empty-state"><p><%= t("shared.no_data") %></p></div>
      <% end %>
    </div>
  </div>
</div>
