<h1 class="text-2xl font-bold text-slate-900 mb-6"><%= t("documentation.show.title") %></h1>

<div class="space-y-6">
  <!-- SDK Installation -->
  <div class="card p-6">
    <h2 class="text-lg font-semibold text-slate-900 mb-1"><%= t("documentation.show.sdk_setup") %></h2>
    <p class="text-sm text-slate-500 mb-4"><%= t("documentation.show.sdk_setup_description") %></p>

    <div class="space-y-4">
      <div class="rounded-lg overflow-hidden border border-slate-700">
        <div class="bg-slate-800 px-4 py-2 text-xs font-mono text-slate-400">npm</div>
        <pre class="bg-slate-900 text-emerald-400 p-4 text-xs overflow-x-auto"><code>npm install margindash</code></pre>
      </div>

      <div class="rounded-lg overflow-hidden border border-slate-700">
        <div class="bg-slate-800 px-4 py-2 text-xs font-mono text-slate-400">pip</div>
        <pre class="bg-slate-900 text-emerald-400 p-4 text-xs overflow-x-auto"><code>pip install margindash</code></pre>
      </div>
    </div>
  </div>

  <!-- TypeScript Usage -->
  <div class="card p-6">
    <h2 class="text-lg font-semibold text-slate-900 mb-1"><%= t("documentation.show.typescript_usage") %></h2>
    <p class="text-sm text-slate-500 mb-4"><%= t("documentation.show.typescript_usage_description") %></p>

    <div class="rounded-lg overflow-hidden border border-slate-700">
      <div class="bg-slate-800 px-4 py-2 flex items-center justify-between">
        <span class="text-xs font-mono text-slate-400">TypeScript</span>
        <span class="flex items-center gap-3 text-xs font-mono">
          <span class="flex items-center gap-1"><span class="inline-block w-2 h-2 rounded-full bg-amber-300"></span> <span class="text-slate-500">MarginDash SDK</span></span>
          <span class="flex items-center gap-1"><span class="inline-block w-2 h-2 rounded-full bg-emerald-400"></span> <span class="text-slate-500">Your code</span></span>
        </span>
      </div>
      <pre class="bg-slate-900 p-4 text-xs overflow-x-auto"><code><span class="text-amber-300">import { MarginDash } from "margindash";</span>
<span class="text-emerald-400">import OpenAI from "openai";</span>

<span class="text-amber-300">const np = new MarginDash({
  apiKey: "<%= @organization.api_key.first(8) %>••••••••••••",
  baseUrl: "<%= request.base_url %>/api/v1",
});</span>
<span class="text-emerald-400">const openai = new OpenAI();

const response = await openai.chat.completions.create({
  model: "gpt-4o",
  messages: [{ role: "user", content: "Hello!" }],
});</span>

<span class="text-amber-300">np.addUsage("openai", {
  model: response.model,
  inputTokens: response.usage!.prompt_tokens,
  outputTokens: response.usage!.completion_tokens,
});
np.track({
  customerExternalId: "cust_123",
  revenueAmountInCents: 500,
});</span>

<span class="text-slate-500">// Events are flushed automatically in the background.
// Before your process exits:</span>
<span class="text-amber-300">await np.shutdown();</span></code></pre>
    </div>
  </div>

  <!-- Python Usage -->
  <div class="card p-6">
    <h2 class="text-lg font-semibold text-slate-900 mb-1"><%= t("documentation.show.python_usage") %></h2>
    <p class="text-sm text-slate-500 mb-4"><%= t("documentation.show.python_usage_description") %></p>

    <div class="rounded-lg overflow-hidden border border-slate-700">
      <div class="bg-slate-800 px-4 py-2 flex items-center justify-between">
        <span class="text-xs font-mono text-slate-400">Python</span>
        <span class="flex items-center gap-3 text-xs font-mono">
          <span class="flex items-center gap-1"><span class="inline-block w-2 h-2 rounded-full bg-amber-300"></span> <span class="text-slate-500">MarginDash SDK</span></span>
          <span class="flex items-center gap-1"><span class="inline-block w-2 h-2 rounded-full bg-emerald-400"></span> <span class="text-slate-500">Your code</span></span>
        </span>
      </div>
      <pre class="bg-slate-900 p-4 text-xs overflow-x-auto"><code><span class="text-emerald-400">import asyncio</span>
<span class="text-emerald-400">from openai import AsyncOpenAI</span>
<span class="text-amber-300">from margindash import MarginDash, Event, Usage</span>

<span class="text-emerald-400">async def main():</span>
<span class="text-emerald-400">    openai = AsyncOpenAI()</span>

<span class="text-amber-300">    async with MarginDash(
        api_key="<%= @organization.api_key.first(8) %>••••••••••••",
        base_url="<%= request.base_url %>/api/v1",
    ) as np:</span>
<span class="text-emerald-400">        response = await openai.chat.completions.create(
            model="gpt-4o",
            messages=[{"role": "user", "content": "Hello!"}],
        )</span>

<span class="text-amber-300">        np.add_usage("openai", Usage(
            model=response.model,
            input_tokens=response.usage.prompt_tokens,
            output_tokens=response.usage.completion_tokens,
        ))
        np.track(Event(
            customer_external_id="cust_123",
            revenue_amount_in_cents=500,
        ))</span>

<span class="text-slate-500">    # Events are automatically flushed when exiting the context manager.</span>

<span class="text-emerald-400">asyncio.run(main())</span></code></pre>
    </div>
  </div>

  <!-- Vendor Costs Note -->
  <div class="card p-6">
    <h2 class="text-lg font-semibold text-slate-900 mb-1"><%= t("documentation.show.vendor_costs") %></h2>
    <div class="flex items-start gap-2 bg-blue-50 border border-blue-200 rounded-lg p-4">
      <svg class="w-4 h-4 text-blue-500 mt-0.5 shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"/></svg>
      <p class="text-sm text-blue-700"><strong>Privacy first:</strong> Only the model name and token counts are sent to MarginDash &mdash; no request or response content ever leaves your infrastructure. Pass the vendor name and usage via <code class="bg-blue-100 px-1.5 py-0.5 rounded text-xs font-mono">addUsage()</code>, and MarginDash calculates cost from your configured vendor rates. For agent sessions with multiple AI calls, call <code class="bg-blue-100 px-1.5 py-0.5 rounded text-xs font-mono">addUsage()</code> once per call, then <code class="bg-blue-100 px-1.5 py-0.5 rounded text-xs font-mono">track()</code> once to attach them all.</p>
    </div>
  </div>

  <!-- Linking Stripe to Usage Tracking -->
  <div class="card p-6">
    <h2 class="text-lg font-semibold text-slate-900 mb-1">Linking Stripe to Usage Tracking</h2>
    <p class="text-sm text-slate-600 mb-4">
      By passing your <code class="bg-slate-100 px-1.5 py-0.5 rounded text-xs font-mono">customer_external_id</code> into Stripe's
      <code class="bg-slate-100 px-1.5 py-0.5 rounded text-xs font-mono">client_reference_id</code> or
      <code class="bg-slate-100 px-1.5 py-0.5 rounded text-xs font-mono">metadata</code>, our InvoiceSyncService can automatically
      match Stripe payments to the correct customer in your dashboard. This ensures that invoice revenue
      is attributed to the same customer as your events, enabling accurate margin calculations.
    </p>

    <h3 class="text-sm font-semibold text-slate-800 mb-2">Stripe Checkout Session</h3>
    <p class="text-sm text-slate-500 mb-2">Pass the ID as <code class="bg-slate-100 px-1.5 py-0.5 rounded text-xs font-mono">client_reference_id</code> when creating a Checkout Session:</p>
    <div class="rounded-lg overflow-hidden border border-slate-700 mb-6">
      <div class="bg-slate-800 px-4 py-2 text-xs font-mono text-slate-400">cURL</div>
      <pre class="bg-slate-900 text-emerald-400 p-4 text-xs overflow-x-auto"><code>curl https://api.stripe.com/v1/checkout/sessions \
  -u "sk_live_YOUR_KEY:" \
  -d "mode=subscription" \
  -d "line_items[0][price]=price_ABC123" \
  -d "line_items[0][quantity]=1" \
  --data-urlencode "client_reference_id=CUST_12345" \
  -d "success_url=https://example.com/success" \
  -d "cancel_url=https://example.com/cancel"</code></pre>
    </div>

    <h3 class="text-sm font-semibold text-slate-800 mb-2">Stripe Customer Creation</h3>
    <p class="text-sm text-slate-500 mb-2">Alternatively, store the ID in the customer's metadata when creating a Stripe Customer:</p>
    <div class="rounded-lg overflow-hidden border border-slate-700 mb-6">
      <div class="bg-slate-800 px-4 py-2 text-xs font-mono text-slate-400">cURL</div>
      <pre class="bg-slate-900 text-emerald-400 p-4 text-xs overflow-x-auto"><code>curl https://api.stripe.com/v1/customers \
  -u "sk_live_YOUR_KEY:" \
  -d "name=Acme Corp" \
  -d "email=billing@acme.com" \
  -d "metadata[external_id]=CUST_12345"</code></pre>
    </div>

    <div class="bg-amber-50 border border-amber-200 rounded-lg p-4">
      <div class="flex items-start gap-2">
        <svg class="w-4 h-4 text-amber-500 mt-0.5 shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"/></svg>
        <div>
          <p class="text-sm font-semibold text-amber-800">Developer Note</p>
          <p class="text-sm text-amber-700 mt-1">
            The ID you pass to Stripe (<code class="bg-amber-100 px-1.5 py-0.5 rounded text-xs font-mono">CUST_12345</code>) must exactly match the
            <code class="bg-amber-100 px-1.5 py-0.5 rounded text-xs font-mono">customer_external_id</code> you send in your events.
            If these values don't match, MarginDash cannot link subscription revenue to usage costs, and margin calculations will be inaccurate.
          </p>
        </div>
      </div>
    </div>
  </div>
</div>
